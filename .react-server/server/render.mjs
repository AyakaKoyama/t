import{jsx as y,Fragment as M,jsxs as W}from"react/jsx-runtime";import{ReadableStream as le}from"node:stream/web";import q from"react-server-dom-webpack/server.edge";import{g as t,L as Se,R as we,C as _e,a as Ce,H as Oe,i as xe,b as Pe,u as qe,F as be,c as F,d as O,A as ve,e as Y,f as z,h as D,j as J,S as Ne,k as He,r as Ae,E as Me,l as Fe,m as b,n as de,o as De,p as Q,q as V,s as Z,t as ee,v as fe,w as te,P as Ie,x as Le,I as ke,y as me,M as $e}from"./@lazarv/react-server.G3Vgzaod.mjs";import"node:path";import"node:url";import"node:async_hooks";import"node:worker_threads";import"picocolors";const X=new Proxy({},{get(x,E){if(!x[E]){const[B,v]=E.split("#");x[E]={id:`server://${B}`,name:v,chunks:[]}}return x[E]}});async function Je(x,E={},B={}){const v=t(Se),pe=t(we),G=t(_e)?.[Ce];try{return new Promise(async(p,se)=>{const e=t(Oe);try{xe();const h=e.request.headers.get("origin"),he=h&&new URL(h).protocol,ne=e.request.headers.get("host"),f=t(Pe),P=f.flags.isRemote,R=qe();let N,H,g,oe;const j=e.request.headers.get("content-type")?.includes("multipart/form-data");let Re;const S=decodeURIComponent(e.request.headers.get("react-server-action")??null);if("POST,PUT,PATCH,DELETE".includes(e.request.method)&&(S&&S!=="null"||j)&&!B.skipFunction){let n=async function(){throw new Error("Server action not found")},o=[];if(j){const c={},m=await t(be)(e.request,{handleFile:async({body:i,...s})=>{const a=[];for await(const l of i)a.push(l);const u=`__react_server_file_${s.name}__`;return c[u]={info:s,file:new Blob(a,{type:s.contentType})},u}}),d=new FormData;for(const[i,s]of m.entries())if(c[s]){const{info:a,file:u}=c[s];d.append(i,u,a.filename)}else d.append(i.replace(/^remote:/,""),s);try{o=await q.decodeReply(d,X)}catch{o=d}}else o=await q.decodeReply(await e.request.text(),X);if(S&&S!=="null"){const[c,m]=S.split("#");n=async()=>{try{return{data:await(await globalThis.__webpack_require__(c))[m].bind(null,...o)(),actionId:S,error:null}}catch(d){return{data:null,actionId:S,error:d}}}}else n=await q.decodeAction(o[o.length-1]??o,X);if(typeof n!="function"){const c=new Error("Server Function Not Found");throw c.digest=c.message,c}const{data:r,actionId:w,error:_}=await n();if(H=!0,!j)N=_?Promise.reject(_):r instanceof Buffer?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r;else{const c=await q.decodeFormState(r,o[o.length-1]??o,X);if(c){const[m,d]=c;N=m,g={"React-Server-Action-Key":encodeURIComponent(d)}}else oe=!0,N=r instanceof Buffer?r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength):r}const C=t(F);if(f.flags.isHTML&&C?.response)return p(C.response);O(ve,{formData:o[o.length-1]??o,data:r,error:_,actionId:w})}const ae=e.request.headers.get("if-modified-since"),K=e.request.headers.get("cache-control")==="no-cache",Te=f.flags.isRSC?Y:z;if(ae&&!K&&await t(D)?.get([e.url,"text/x-component",R,Te,ae])!==J)return p(new Response(null,{status:304,statusText:"Not Modified"}));const ge=P||/^https?___/.test(R)?void 0:"default",ce=G.base?n=>`/${G.base}/${n?.id||n}`.replace(/\/+/g,"/"):n=>n?.id||n,ye=P||h&&ne!==h?n=>`${he}//${ne}${ce(n)}`:ce,ie=()=>{const n=t(Ne);return y(M,{children:n.map(o=>{const r=ye(o);return y("link",{rel:"stylesheet",href:r,precedence:ge},r)})})},ue=W(M,{children:[y(ie,{}),y(x,{...E})]}),I=t(He)??!1;I&&(g={...g,"React-Server-Render":I.url.toString(),"React-Server-Outlet":I.outlet});const L=t(F);L?.response&&(g={...g,"React-Server-Render":L.location,"React-Server-Outlet":"PAGE_ROOT"},Ae(L.location));let k=ue;if(H&&f.flags.isRSC&&!f.flags.isRemote&&(g={...g,"React-Server-Data":"rsc"},k=I||L?.response||oe?W(M,{children:[ue,N]}):y(M,{children:[N]})),!P&&!H&&(!R||R&&R==="PAGE_ROOT")){const n=t(Me);if(n&&n.$$typeof===Symbol.for("react.client.reference")){const o=t(Fe);o&&(k=W(M,{children:[y(ie,{}),y(o,{component:n,children:y(x,{...E})})]}))}}const $=new Date().toUTCString();if(f.flags.isRSC&&!f.flags.isRemote){if(!K&&!H){const r=await t(D)?.get([e.url,"text/x-component",R,Y]);if(r!==J)return p(new Response(r.buffer,{status:r.status,statusText:r.statusText,headers:r.headers}))}let n=!1;const o=new le({type:"bytes",async start(r){const w=t(b);O(b,new Headers({"content-type":"text/x-component; charset=utf-8","cache-control":e.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":$,...g,...w?Object.fromEntries(w.entries()):{}}));const C=q.renderToReadableStream(k,de({remote:P,origin:h}),{onError(l){n=!0;const T=t(F);return T?.response?`Location=${T.response.headers.get("location")}`:l?.message}}).getReader();let c=!1;const m=[],d=new Promise(l=>De(()=>l("interrupt")));let i=null;for(;!c;){const l=i||C.read(),T=await Promise.race([l,t(Q)??d]);if(T===Q){O(Q,null),i=l;continue}else if(T==="interrupt"){i=l;break}i=null;const{value:A,done:U}=T;c=U,A&&m.push(V(A))}r.enqueue(new Uint8Array(Z(m)));const s=t(ee)??{status:200,statusText:"OK"},a=t(b)??new Headers,u=new Response(o,{...s,headers:a});for(O(fe,u),p(u);!c;){const{value:l,done:T}=await(i||C.read());i=null,c=T,l&&(m.push(V(l)),r.enqueue(l))}r.close(),n||t(D)?.set([e.url,"text/x-component",R,Y,$],{...s,buffer:Z(m),headers:a})}})}else if(f.flags.isHTML||f.flags.isRemote){if(!K&&!H){const s=await t(D)?.get([e.url,"text/html",R,z]);if(s!==J){const a=new le({type:"bytes",async start(u){u.enqueue(new Uint8Array(s.buffer)),u.close()}});return p(new Response(a,{status:s.status,statusText:s.statusText,headers:s.headers}))}}const n=t(b);O(b,new Headers({"content-type":"text/html; charset=utf-8","cache-control":e.request.headers.get("cache-control")==="no-cache"?"no-cache":"must-revalidate","last-modified":$,...n?Object.fromEntries(n.entries()):{}}));let o=!1;const r=q.renderToReadableStream(k,de({remote:P,origin:h}),{onError(s){o=!0;const a=t(F);return a?.response?p(a.response):s?.message}}),w=te.getStore(),{onPostponed:_}=e,C=t(Ie),c=t(Le),m=t(ke);let d=!1;const i=await pe({stream:r,bootstrapModules:f.flags.isRSC||f.flags.isRemote?[]:t($e),bootstrapScripts:f.flags.isRSC||f.flags.isRemote?[]:[`const moduleCache = new Map();
                    self.__webpack_require__ = function (id) {
                      if (!moduleCache.has(id)) {
                        const modulePromise = /^https?\\:/.test(id) ? import(id) : import(("${`/${G.base??""}/`.replace(/\/+/g,"/")}" + id).replace(/\\/+/g, "/"));
                        modulePromise.then(
                          (module) => {
                            modulePromise.value = module;
                            modulePromise.status = "fulfilled";
                          },
                          (reason) => {
                            modulePromise.reason = reason;
                            modulePromise.status = "rejected";
                          }
                        );
                        moduleCache.set(id, modulePromise);
                      }
                      return moduleCache.get(id);
                    };`.replace(/\n/g,"")],outlet:R,defer:e.request.headers.get("react-server-defer")==="true",start:async()=>{d=!0,te.run(w,async()=>{const s=t(F);if(s?.response)return p(s.response);const a=t(ee)??{status:200,statusText:"OK"},u=t(b)??new Headers,[l,T]=i.tee(),A=[];(async()=>{if(!o){for await(const Ee of T)A.push(V(Ee));await t(D)?.set([e.url,"text/html",R,z,$],{...a,buffer:Z(A),headers:u})}})();const U=new Response(l,{...a,headers:u});O(fe,U),p(U)})},onError(s,a){a&&(s.digest=a),(v??console).error(s),o=!0,d||te.run(w,async()=>{O(ee,{status:500,statusText:"Internal Server Error"}),t(me)?.(s)?.then(p,se)})},formState:Re,isPrerender:typeof _=="function",onPostponed:_,prelude:C,postponed:c,remote:P,origin:h,importMap:m,httpContext:{request:{method:e.request.method,url:e.request.url,headers:Array.from(e.request.headers.entries()).reduce((s,[a,u])=>(s[a]=u,s),{}),destination:e.request.destination,referrer:e.request.referrer,referrerPolicy:e.request.referrerPolicy,mode:e.request.mode,credentials:e.request.credentials,cache:e.request.cache,redirect:e.request.redirect,integrity:e.request.integrity,keepalive:e.request.keepalive,isReloadNavigation:e.request.isReloadNavigation,isHistoryNavigation:e.request.isHistoryNavigation},ip:e.ip,method:e.method,url:e.url.toString()}})}else return p(new Response(null,{status:404,statusText:"Not Found"}))}catch(h){v.error(h),t(me)?.(h)?.then(p,se)}})}catch(re){return v.error(re),new Response(null,{status:500,statusText:"Internal Server Error"})}}export{Je as render};
